{"version":3,"sources":["webpack:///./src/utils/index.js","webpack:///./src/subjects/route.js","webpack:///./src/subjects/search.js","webpack:///./src/pages/index.js"],"names":["combine","dict","keys","Object","map","vals","reduce","val","i","_Object$assign","assign","combineLatest","apply","key","r","isObservable","of","fix","make","k","Symbol","_make","o1","o2","_make2","i1","i2","fn","list","_i","length","_list$_i","k1","k2","config","fromESObservable","from","toESObservable","stream","mapPropsStream","mapPropsStreamWithConfig","appendPropsStream","p","o","router","createRouter","name","path","usePlugin","browserPlugin","useHash","createObservables","route$","transitionError$","routeNode","transitionRoute$","route","Map","pipe","shareReplay","subscribe","Boolean","start","isLoading","BehaviorSubject","e","encodeURIComponent","query","filter","q","params","startWith","distinctUntilChanged","pushquery","word","isActive","Promise","resolve","getState","res","rej","navigate","opts","s","search","debounceTime","switchMap","ajax","getJSON","ROOT","tap","v","next","results","handleQuery","target","value","withRoute","withQuery","withSearch","Img","_ref","childrenClassName","objectWithoutPropertiesLoose_default","react_default","a","createElement","style","maxHeight","Link","_ref2","props","rel","Index","compose","_ref3","core_index_es","onChange","item","mal_id","pages_Img","src","image_url","pages_Link","href","url","concat","anime","manga","getAnimeNames","type","NotFound","Route","_ref4","pages_NotFound"],"mappings":"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","file":"component---src-pages-index-js-3e37fd05577fe1df3230.js","sourcesContent":["/**\r\n * @template S\r\n * @typedef {import(\"rxjs\").Observable<S>} Observable<S>\r\n */\r\nimport { compose, mapPropsStreamWithConfig } from 'recompose'\r\nimport { BehaviorSubject, combineLatest, of, isObservable, from } from 'rxjs'\r\nimport { map, switchMap, shareReplay } from 'rxjs/operators'\r\n\r\nexport { compose }\r\n\r\n/**\r\n * @type {<T extends {}>(obj: T) => Observable<{\r\n     [K in keyof T]: T[K] extends Observable<infer U>\r\n     ? U : T[K]\r\n   }>}\r\n */\r\nexport const combine = dict => {\r\n\tconst keys = Object.keys(dict)\r\n\treturn map(vals =>\r\n\t\tvals.reduce((dict, val, i) => ({ ...dict, [keys[i]]: val }), {}),\r\n\t)(\r\n\t\tcombineLatest(\r\n\t\t\t...keys.map(key => {\r\n\t\t\t\tconst r = dict[key]\r\n\t\t\t\treturn isObservable(r) ? r : of(r)\r\n\t\t\t}),\r\n\t\t),\r\n\t)\r\n}\r\n\r\n/**\r\n * @template T\r\n * @type {<T>(def: T) => [import(\"rxjs\").BehaviorSubject<T>, (p: T) => void]}\r\n */\r\nexport const createState = def => {\r\n\tconst sub = new BehaviorSubject(def)\r\n\treturn [sub, p => sub.next(p)]\r\n}\r\n\r\n/**\r\n * @template T, K\r\n * @type {<T, K>({timeout}?: {timeout?: number}) => {\r\n     remove: (key: K) => void\r\n     select: (key: K, get: () => Observable<T>) => Observable<T>\r\n   }}\r\n */\r\nexport const createCache = ({ timeout } = {}) => {\r\n\tlet num = 0\r\n\tconst [pin, push] = createState(num)\r\n\tconst cachem = new Map()\r\n\tconst cachew = new WeakMap()\r\n\tconst find = key => (key && 'object' === typeof key ? cachew : cachem)\r\n\tconst select = (key, get) => {\r\n\t\tconst cache = find(key)\r\n\t\tif (cache.has(key)) return cache.get(key)\r\n\t\tconst val = get()\r\n\t\tcache.set(key, val)\r\n\t\tif (0 < timeout) setTimeout(() => cache.delete(key), timeout)\r\n\t\treturn val\r\n\t}\r\n\treturn {\r\n\t\tremove: key => {\r\n\t\t\tconst cache = find(key)\r\n\t\t\t//@ts-ignore\r\n\t\t\tcache.delete(key)\r\n\t\t\tpush(++num)\r\n\t\t},\r\n\t\tselect: (key, get) =>\r\n\t\t\tswitchMap(() => select(key, () => shareReplay(1)(get())))(pin),\r\n\t}\r\n}\r\n\r\n// https://github.com/ReactiveX/rxjs/issues/4415\r\n/** @type {<P, S>(r: (a: P, ...b: *[]) => S) => (a: P) => S} */\r\nconst fix = (() => {\r\n\tconst make = k => {\r\n\t\tconst s1 = (typeof Symbol === 'function' && Symbol[k]) || '@@' + k\r\n\t\tconst s2 =\r\n\t\t\t(typeof Symbol === 'function' && (Symbol[k] || Symbol(k))) || '@@' + k\r\n\t\treturn [s1, s2]\r\n\t}\r\n\tconst [o1, o2] = make('observable')\r\n\tconst [i1, i2] = make('iterator')\r\n\tif (o1 === o2) return fn => fn\r\n\tconst list = [[o1, o2], [o2, o1], [i1, i2], [i2, i1]]\r\n\treturn fn => r => {\r\n\t\tif (r)\r\n\t\t\tfor (const [k1, k2] of list)\r\n\t\t\t\tif ('function' === typeof r[k2] && 'undefined' === typeof r[k1])\r\n\t\t\t\t\tr[k1] = r[k2]\r\n\t\treturn fn(r)\r\n\t}\r\n})()\r\n/** @type {import(\"recompose\").ObservableConfig} */\r\nconst config = {\r\n\t//@ts-ignore\r\n\tfromESObservable: fix(from),\r\n\ttoESObservable: fix(stream => stream),\r\n}\r\nexport const mapPropsStream = mapPropsStreamWithConfig(config)\r\n\r\n/**\r\n * @template T, S\r\n * @param {import(\"recompose\").mapper<Observable<T>, Observable<S>>} fn\r\n * @returns {import(\"recompose\").ComponentEnhancer<T & S, T>}\r\n */\r\nexport const appendPropsStream = fn =>\r\n\tmapPropsStream(\r\n\t\t/** @param {Observable<T>} p */ p =>\r\n\t\t\tcombineLatest(p, fn(p), (p, o) => ({ ...p, ...o })),\r\n\t)\r\n","import createRouter from 'router5'\r\nimport browserPlugin from 'router5-plugin-browser'\r\nimport createObservables from 'rxjs-router5'\r\nimport { shareReplay } from 'rxjs/operators'\r\n\r\n/**\r\n * @type {import(\"router5\").Route[]}\r\n */\r\nconst routes = [\r\n\t{ name: 'home', path: '/' },\r\n\t{ name: 'home/search', path: '/q/*query' },\r\n]\r\n\r\nconst router = createRouter(routes)\r\n\r\nrouter.usePlugin(browserPlugin({ useHash: true }))\r\n\r\nconst {\r\n\troute$,\r\n\trouteNode: routeNodeF,\r\n\ttransitionError$,\r\n\ttransitionRoute$,\r\n} = createObservables(router)\r\n\r\n/** @type {Map<string, import(\"rxjs\").Observable<import(\"router5\").State>>} */\r\nconst cache = new Map()\r\n\r\nexport const route = route$.pipe(shareReplay(1))\r\nexport const routeNode = s => {\r\n\tif (!cache.has(s)) cache.set(s, routeNodeF(s))\r\n\treturn cache.get(s)\r\n}\r\nexport const transitionError = transitionError$.pipe(shareReplay(1))\r\nexport const transitionRoute = transitionRoute$.pipe(shareReplay(1))\r\n\r\nexport default route\r\n\r\nroute.subscribe(Boolean)\r\n\r\n/**\r\n * @typedef {import(\"router5/types/types/base\").Params} Params\r\n * @typedef {import(\"router5/types/types/base\").NavigationOptions} NavigationOptions\r\n * @typedef {import(\"router5/types/types/base\").DoneFn} DoneFn\r\n * @typedef {import(\"router5/types/types/base\").State} State\r\n */\r\n/** @type {(routeName: string, params?: Params, options?: NavigationOptions) => Promise<State>} */\r\nexport const pushState = (name, params, opts) =>\r\n\trouter.isActive(name, params)\r\n\t\t? Promise.resolve(router.getState())\r\n\t\t: new Promise((res, rej) =>\r\n\t\t\t\trouter.navigate(name, params, opts, (e, s) => (e ? rej(e) : res(s))),\r\n\t\t  )\r\n\r\nrouter.start()\r\n","import { ajax } from 'rxjs/ajax'\r\nimport { BehaviorSubject } from 'rxjs'\r\nimport {\r\n\tfilter,\r\n\tswitchMap,\r\n\tdistinctUntilChanged,\r\n\tshareReplay,\r\n\tstartWith,\r\n\tmap,\r\n\ttap,\r\n\tdebounceTime,\r\n} from 'rxjs/operators'\r\n\r\nimport { route, pushState } from './route'\r\n\r\nconst ROOT = 'https://api.jikan.moe/v3'\r\n\r\nexport const isLoading = new BehaviorSubject(false)\r\n\r\nconst e = encodeURIComponent\r\n\r\nexport const query = route.pipe(\r\n\tfilter(q => q && 'home/search' === q.name),\r\n\tmap(q => q.params.query),\r\n\tstartWith(''),\r\n\tdistinctUntilChanged(),\r\n\tshareReplay(1),\r\n)\r\nexport const pushquery = word => pushState('home/search', { query: word })\r\nexport const search = query.pipe(\r\n\tfilter(Boolean),\r\n\tdebounceTime(1000),\r\n\tdistinctUntilChanged(),\r\n\tswitchMap(q =>\r\n\t\tajax.getJSON(`${ROOT}/search/character?q=${e(q)}&page=1`).pipe(\r\n\t\t\tstartWith(null),\r\n\t\t\ttap(v => isLoading.next(!v)),\r\n\t\t),\r\n\t),\r\n\tfilter(Boolean),\r\n\tmap(r => r.results),\r\n\tshareReplay(1),\r\n\tstartWith([]),\r\n)\r\n","import React from 'react'\r\n\r\nimport { combine, appendPropsStream, compose } from '../utils'\r\nimport { route } from '../subjects/route'\r\nimport { search, query, pushquery, isLoading } from '../subjects/search'\r\n\r\nimport {\r\n\tTextField,\r\n\tList,\r\n\tListItem,\r\n\tListItemText,\r\n\tListItemAvatar,\r\n\tTypography,\r\n} from '@material-ui/core'\r\n\r\nconst handleQuery = e => pushquery(e.target.value)\r\nconst withRoute = appendPropsStream(() => combine({ route }))\r\nconst withQuery = appendPropsStream(() => combine({ query, handleQuery }))\r\nconst withSearch = appendPropsStream(() => combine({ search, isLoading }))\r\n\r\nconst Img = ({ childrenClassName: _, ...p }) => {\r\n\treturn <img style={{ maxHeight: '100px' }} {...p} />\r\n}\r\nconst Link = ({ childrenClassName: _, ...props }) => (\r\n\t<a target=\"_blank\" rel=\"noopener noreferrer\" {...props} />\r\n)\r\nconst getAnimeNames = item => {\r\n\treturn [].concat(item.anime, item.manga)\r\n}\r\nconst IndexView = ({ route, search, query, handleQuery, isLoading }) => (\r\n\t<div>\r\n\t\t<TextField value={query} onChange={handleQuery} />\r\n\t\t{isLoading ? <Typography>isLoading...</Typography> : null}\r\n\t\t{'home' === route.name ? (\r\n\t\t\t<Typography>input search name</Typography>\r\n\t\t) : (\r\n\t\t\t<List>\r\n\t\t\t\t{search.map(item => (\r\n\t\t\t\t\t<ListItem key={item.mal_id}>\r\n\t\t\t\t\t\t<ListItemAvatar>\r\n\t\t\t\t\t\t\t<Img src={item.image_url} />\r\n\t\t\t\t\t\t</ListItemAvatar>\r\n\t\t\t\t\t\t<ListItemText>\r\n\t\t\t\t\t\t\t<Link href={item.url}>{item.name}</Link>\r\n\t\t\t\t\t\t</ListItemText>\r\n\t\t\t\t\t\t<ListItemText>\r\n\t\t\t\t\t\t\t{getAnimeNames(item).map(a => (\r\n\t\t\t\t\t\t\t\t<Link key={a.mal_id} href={a.url}>\r\n\t\t\t\t\t\t\t\t\t{a.type}: {a.name}\r\n\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</ListItemText>\r\n\t\t\t\t\t</ListItem>\r\n\t\t\t\t))}\r\n\t\t\t</List>\r\n\t\t)}\r\n\t</div>\r\n)\r\nconst Index = compose(\r\n\twithRoute,\r\n\twithQuery,\r\n\twithSearch,\r\n)(IndexView)\r\n\r\nconst NotFound = () => <div>not found</div>\r\n\r\nconst RouteView = ({ route }) => {\r\n\tif (!route) return null\r\n\r\n\tswitch (route.name) {\r\n\t\tcase 'home':\r\n\t\tcase 'home/search':\r\n\t\t\treturn <Index />\r\n\t\tdefault:\r\n\t\t\treturn <NotFound />\r\n\t}\r\n}\r\nconst Route = withRoute(RouteView)\r\n\r\nexport default Route\r\n"],"sourceRoot":""}